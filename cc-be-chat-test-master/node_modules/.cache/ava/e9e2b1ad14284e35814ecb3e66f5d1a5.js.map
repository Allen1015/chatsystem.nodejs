{"version":3,"sources":["test.js"],"names":["WebSocket","require","Player","PlayerMgr","ChatRecords","ProfanityFilter","GMMgr","PopularMgr","playermgr","chatrecords","profantiyfilter","gmmgr","popularmgr","t","word","checkWords","is","uid","wss","Server","port","on","connection","ws","incoming","message","player","addPlayer","broadCastsChatRecords","getPlayerByTask","palyer","wordafter","playerInfo","broadCasts","addChatRecord","wordaftermessage","parse","addPopular","removePlayerByTask","send","loadTXT","initGM","setInterval","timeRemovePopular","console","log"],"mappings":"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","sourceRoot":"D:\\code\\cc-be-chat-test-master","sourcesContent":["import test from 'ava';\n\n// 实例化 websocket\nconst WebSocket = require('ws');\n// 引用 Player 类\nvar Player =  require('./Player.class');\n// 引用 PlayerMgr 类\nvar PlayerMgr = require('./PlayerMgr.class');\n// 引用 ChatRecords 类\nvar ChatRecords = require('./ChatRecords.class');\n// 引用 ProfanityFilter 类\nvar ProfanityFilter = require('./ProfanityFilter.class');\n// 引用 GMMgr 类\nvar GMMgr = require('./GMMgr.class');\n// 引用 PopularMgr 类\nvar PopularMgr = require('./PopularMgr.class');\n\n\n\n\n// 实例化 PlayerMgr\nvar playermgr = new PlayerMgr();\n// 实例化 ChatRecords\nvar chatrecords = new ChatRecords();\n// 实例化 ProfanityFilter\nvar profantiyfilter = new ProfanityFilter();\n// 实例化 GMMgr\nvar gmmgr = new GMMgr();\n// 实例化 PopularMgr\nvar popularmgr = new PopularMgr();\n\n\n\ntest(\"checkWords test\",t => {\n      var word = profantiyfilter.checkWords(\"nobhead\");\n      t.is(word, '******');\n})\n\n// 玩家ID索引\nvar uid = 1;\n\n// 创建 WebSocket 服务\nconst wss = new WebSocket.Server({ port: 8080 });\n\n// 收到客户端连接\nwss.on('connection', function connection(ws) {\n\n    // 客户消息\n    ws.on('message', function incoming(message) {\n        if (message == 'client request connect') {\n          // console.log('some player come in');\n          var player = new Player(uid,\"玩家名字\",ws);\n          // 添加玩家\n          playermgr.addPlayer(uid,player);\n          // 同步聊天记录\n          chatrecords.broadCastsChatRecords(player);\n          uid++;\n        } else {\n            // console.log('server rev data:', message);\n            playermgr.getPlayerByTask(ws,function (palyer){\n            // 检查屏蔽字\n            var wordafter =  profantiyfilter.checkWords(palyer.playerInfo()+message);\n            // 广播聊天记录\n            playermgr.broadCasts(wordafter);\n            // 添加聊天记录\n            chatrecords.addChatRecord(wordafter);\n\n            var wordaftermessage = profantiyfilter.checkWords(message);\n            // 解析GM命令\n            gmmgr.parse(wordaftermessage,palyer,popularmgr);\n            // 添加流行词\n            popularmgr.addPopular(wordaftermessage);\n          });\n        \n        }\n    });\n\n    // socket关闭\n    ws.on('close', function () {\n      // console.log('some player leave');\n      playermgr.removePlayerByTask(ws);\n  });\n\n    // 服务器发送的数据\n    ws.send('connect server successful!!');\n});\n\n// 加载屏蔽字库\nprofantiyfilter.loadTXT();\n// 加载GM命令\ngmmgr.initGM();\n\n// 一秒定时器\nsetInterval(function() {\n  popularmgr.timeRemovePopular();\n}, 1000);\n\n// 服务器启动成功\nconsole.log('server start ok！！');\n\n"]}